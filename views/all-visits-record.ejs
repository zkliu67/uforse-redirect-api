  <%- include('./includes/header.ejs') %>
  <link rel="stylesheet" href="/css/companies.css">
</head>

<body>
  <h3>Total Visits: <%= visitsCount %></h3>
  <table>
    <tr>
      <th>Date</th>
      <% for (let company of companies) { %> 
      <th>
        <div class="company__detail__th">
          <p class="company__detail__name"><%= company.companyName %></p>
          <p>Valid from: <%= moment(company.startDate).format('YYYY-MM-DD') %> 
            <% if (company.endDate) { %> to <%= moment(company.endDate).format('YYYY-MM-DD') %></p> <% } %>   
          <p>Contact Info: <%= company.contactName %></p>
          <p>Phone: <%= company.contactPhone %></p>
          <p>Email: <%= company.contactEmail %></p>
          <p>Link: <%= company.redirectLink %></p>
        </div>
      </th>
      <% } %> 
      <th>Total</th>
    </tr>
    <%- include('./includes/visit-table-row.ejs', { allVisits: allVisits }) %> 
  </table>
</body>

<script>
  $('span[name="display"]').click(function() {
    const display = $(this).attr('display');
    const monthDate = $(this).attr('data-id');

    if (display === 'false') {
      const params = {monthDate: monthDate};
      const currRow = $(this).closest('tr')
      const currRowId = currRow.attr('row-index');
      console.log(currRowId);

      $.get('/admin/all-visits', params, function(data) {
        $(data).insertAfter(currRow)
      })

      $(this).attr('display', 'true');
      $(this).text('show less');
    }

    else {
      $('tr[class="daily__table__row"]').remove();
      $(this).attr('display', 'false');
      $(this).text('show more');
    }
    
    

    
  })
</script>
<%- include('./includes/end.ejs') %> 